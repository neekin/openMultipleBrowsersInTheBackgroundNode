# Puppeteer å¤šå®ä¾‹è¿œç¨‹æ§åˆ¶ç³»ç»Ÿ - æŠ–éŸ³ä¸“ç”¨ä¼˜åŒ–ç‰ˆ

## é¡¹ç›®ç®€ä»‹
åŸºäº Node.js + Express + Puppeteer çš„**æŠ–éŸ³ä¸“ç”¨ä¼˜åŒ–**å¤šå®ä¾‹æµè§ˆå™¨è¿œç¨‹æ§åˆ¶ç³»ç»Ÿï¼Œä¸“é—¨é’ˆå¯¹ www.douyin.com è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼Œæ”¯æŒç™»å½•çŠ¶æ€ä¿æŒã€è§†é¢‘å±è”½ã€ç½‘ç»œä¿æ´»ï¼ŒåŒæ—¶å…·å¤‡**è¶…ä½å†…å­˜**ç®¡ç†èƒ½åŠ›ã€‚

## ğŸµ æŠ–éŸ³ä¸“ç”¨ä¼˜åŒ–ç‰¹æ€§ 
- ğŸ­ **æŠ–éŸ³ä¸“ç”¨ç®¡ç†å™¨**ï¼šä¸“é—¨ä¸ºæŠ–éŸ³ç½‘ç«™è®¾è®¡çš„æµè§ˆå™¨å®ä¾‹ç®¡ç†
- ğŸ“± **ç§»åŠ¨ç«¯æ¨¡æ‹Ÿ**ï¼šæ¨¡æ‹ŸiPhoneè®¾å¤‡ï¼Œè·å¾—æœ€ä½³æŠ–éŸ³ä½“éªŒ
- ğŸ” **ç™»å½•çŠ¶æ€ä¿æŒ**ï¼šè‡ªåŠ¨ä¿æŒæŠ–éŸ³ç™»å½•çŠ¶æ€ï¼Œæ”¯æŒCookieæŒä¹…åŒ–
- ğŸš« **æ™ºèƒ½è§†é¢‘å±è”½**ï¼šç¦ç”¨è§†é¢‘æ’­æ”¾èŠ‚çœå¸¦å®½ï¼Œä¿ç•™å›¾ç‰‡å’ŒJSåŠŸèƒ½
- ğŸŒ **ç½‘ç»œä¿æ´»æœºåˆ¶**ï¼šå®šæœŸå‘é€å¿ƒè·³è¯·æ±‚ï¼Œä¿æŒç½‘ç»œè¿æ¥æ´»è·ƒ
- ğŸ“Š **ç™»å½•çŠ¶æ€ç›‘æ§**ï¼šå®æ—¶ç›‘æ§ç™»å½•çŠ¶æ€ï¼Œè‡ªåŠ¨æ£€æµ‹æ‰çº¿
- ğŸ¯ **èµ„æºä¼˜åŒ–åŠ è½½**ï¼šä»…åŠ è½½å¿…è¦èµ„æºï¼Œå±è”½å¹¿å‘Šå’Œè¿½è¸ª
- âš¡ **æ€§èƒ½ä¼˜åŒ–é…ç½®**ï¼šä¸“é—¨çš„å¯åŠ¨å‚æ•°å’Œé¡µé¢ä¼˜åŒ–è„šæœ¬

## ğŸš€ è¶…ä½å†…å­˜ä¼˜åŒ–ç‰¹æ€§ 
- ğŸ§  **è¶…ä½å†…å­˜æ¨¡å¼**ï¼šæ¯å®ä¾‹ä»…éœ€ ~30MB å†…å­˜ï¼Œæ¯”æ ‡å‡†æ¨¡å¼èŠ‚çœ 60%+
- ğŸ˜´ **æ™ºèƒ½ä¼‘çœ æœºåˆ¶**ï¼šè‡ªåŠ¨ä¼‘çœ ç©ºé—²å®ä¾‹ï¼Œæ”¯æŒå¿«é€Ÿå”¤é†’å’ŒçŠ¶æ€æ¢å¤
- ğŸ“ˆ **å†…å­˜å‹åŠ›æ„ŸçŸ¥**ï¼šå®æ—¶ç›‘æ§ç³»ç»Ÿå†…å­˜ï¼Œè‡ªåŠ¨è°ƒæ•´å®ä¾‹ç­–ç•¥
- âš¡ **ç´§æ€¥å†…å­˜é‡Šæ”¾**ï¼šå†…å­˜ä¸è¶³æ—¶è‡ªåŠ¨é‡Šæ”¾éå…³é”®å®ä¾‹
- ğŸ”„ **å®ä¾‹æ± ç®¡ç†**ï¼šå¤ç”¨å®ä¾‹å‡å°‘åˆ›å»ºå¼€é”€ï¼Œæå‡å“åº”é€Ÿåº¦
- ğŸ“Š **å¢å¼ºç»Ÿè®¡é¢æ¿**ï¼šå®æ—¶æ˜¾ç¤ºå†…å­˜å‹åŠ›ã€ä¼‘çœ çŠ¶æ€ã€å®ä¾‹åˆ†å¸ƒ
- ğŸ¯ **åŠ¨æ€å®ä¾‹é™åˆ¶**ï¼šæ ¹æ®ç³»ç»Ÿèµ„æºåŠ¨æ€è°ƒæ•´æœ€å¤§å®ä¾‹æ•°
- ï¿½ **æ¿€è¿›å†…å­˜æ¸…ç†**ï¼šé¡µé¢çº§å†…å­˜ä¼˜åŒ–ï¼Œå®šæ—¶åƒåœ¾å›æ”¶

## å†…å­˜ä¼˜åŒ–æ•ˆæœå¯¹æ¯”
| æ¨¡å¼ | å•å®ä¾‹å†…å­˜ | æœ€å¤§å¹¶å‘æ•° | å†…å­˜åˆ©ç”¨ç‡ | å“åº”é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|------|-----------|-----------|-----------|----------|----------|
| æ ‡å‡†æ¨¡å¼ | ~80MB | 20-30ä¸ª | 70% | ä¸€èˆ¬ | é€šç”¨ç½‘ç«™ |
| å†…å­˜ä¼˜åŒ– | ~50MB | 40-50ä¸ª | 80% | è¾ƒå¿« | è½»é‡ç½‘ç«™ |
| **è¶…ä½å†…å­˜** | **~30MB** | **60-100ä¸ª** | **85%** | **æœ€å¿«** | **é™æ€é¡µé¢** |
| **æŠ–éŸ³ä¼˜åŒ–** | **~80MB** | **30-50ä¸ª** | **80%** | **æœ€å¿«** | **æŠ–éŸ³ä¸“ç”¨** |

## æŠ–éŸ³ä¼˜åŒ–ç‰¹æ€§å¯¹æ¯”
| åŠŸèƒ½ç‰¹æ€§ | æ ‡å‡†æ¨¡å¼ | æŠ–éŸ³ä¼˜åŒ–æ¨¡å¼ | ä¼˜åŒ–æ•ˆæœ |
|----------|----------|-------------|----------|
| å†…å­˜å ç”¨ | ~150MB | **~80MB** | **47%â†“** |
| è§†é¢‘åŠ è½½ | æ­£å¸¸ | **ç¦ç”¨** | **90%+å¸¦å®½èŠ‚çœ** |
| ç™»å½•ä¿æŒ | éœ€æ‰‹åŠ¨ | **è‡ªåŠ¨ä¿æ´»** | **100%å¯é ** |
| ç§»åŠ¨é€‚é… | æ¡Œé¢ç‰ˆ | **iPhoneæ¨¡æ‹Ÿ** | **ä½“éªŒä¼˜åŒ–** |
| èµ„æºè¿‡æ»¤ | åŸºç¡€ | **æ·±åº¦ä¼˜åŒ–** | **60%èµ„æºèŠ‚çœ** |

## æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§
- ğŸš€ å¤šå®ä¾‹ç®¡ç†ï¼šåˆ›å»ºã€åˆ é™¤ã€æ¢å¤ã€ä¼‘çœ æµè§ˆå™¨å®ä¾‹
- ğŸ”’ ä¼šè¯éš”ç¦»ï¼šæ¯ä¸ªå®ä¾‹ç‹¬ç«‹çš„ userDataDirï¼Œå®Œå…¨éš”ç¦» cookies/session
- ğŸ­ æŒ‡çº¹éšæœºï¼šéšæœºåŒ– User-Agentã€è§†å£å¤§å°ç­‰æµè§ˆå™¨æŒ‡çº¹
- ğŸ“± å®æ—¶æ§åˆ¶ï¼šWebSocket å®æ—¶æˆªå›¾ã€é¼ æ ‡é”®ç›˜æ“ä½œ
- ğŸ’¾ æŒä¹…åŒ–å­˜å‚¨ï¼šSQLite æ•°æ®åº“å­˜å‚¨å®ä¾‹ä¿¡æ¯ï¼Œæ”¯æŒæœåŠ¡é‡å¯åæ¢å¤
- ğŸ·ï¸ æ ‡ç­¾é¡µç®¡ç†ï¼šæ”¯æŒå¤šæ ‡ç­¾é¡µåˆ‡æ¢ã€åˆ·æ–°ã€å…³é—­æ“ä½œ
- ğŸ¯ è‡ªåŠ¨æ¢å¤ï¼šæœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤å†å²å®ä¾‹
- âš¡ è¶…ä½å†…å­˜ä¼˜åŒ–ï¼šä¼‘çœ æœºåˆ¶ã€å†…å­˜å‹åŠ›æ„ŸçŸ¥ã€ç´§æ€¥é‡Šæ”¾

## é¡¹ç›®ç»“æ„
```
â”œâ”€â”€ index.js                    # ä¸»æœåŠ¡æ–‡ä»¶
â”œâ”€â”€ config.js                   # é…ç½®ç®¡ç†ï¼ˆå«æŠ–éŸ³ä¸“ç”¨é…ç½®ï¼‰
â”œâ”€â”€ browserManager.js           # æµè§ˆå™¨å®ä¾‹ç®¡ç†æ¨¡å—ï¼ˆæ”¯æŒæŠ–éŸ³æ£€æµ‹ï¼‰
â”œâ”€â”€ memoryOptimizedBrowserManager.js   # æ ‡å‡†å†…å­˜ä¼˜åŒ–ç®¡ç†å™¨
â”œâ”€â”€ ultraLowMemoryManager.js    # è¶…ä½å†…å­˜ç®¡ç†å™¨
â”œâ”€â”€ douyinOptimizedManager.js   # æŠ–éŸ³ä¸“ç”¨ä¼˜åŒ–ç®¡ç†å™¨ï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ wsManager.js                # WebSocket è¿æ¥å’Œæ“ä½œå¤„ç†
â”œâ”€â”€ performanceManager.js       # æ€§èƒ½ç›‘æ§å’Œä¼˜åŒ–ç®¡ç†å™¨
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ browsers.js             # å®ä¾‹ç®¡ç† API è·¯ç”±ï¼ˆæ–°å¢æŠ–éŸ³ä¸“ç”¨APIï¼‰
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ index.html              # å‰ç«¯ç•Œé¢
â”‚   â”œâ”€â”€ performance.html        # æ€§èƒ½ç›‘æ§é¢æ¿
â”‚   â””â”€â”€ advanced-dashboard.html # é«˜çº§ä»ªè¡¨æ¿ï¼ˆæ–°å¢æŠ–éŸ³æ§åˆ¶é¢æ¿ï¼‰
â”œâ”€â”€ user_data/                  # ç”¨æˆ·æ•°æ®ç›®å½•
â”œâ”€â”€ browsers.db                 # SQLite æ•°æ®åº“
â”œâ”€â”€ package.json                # é¡¹ç›®ä¾èµ–
â””â”€â”€ ecosystem.config.js         # PM2 é…ç½®æ–‡ä»¶
```

## æ ¸å¿ƒæ¨¡å—è¯´æ˜

### douyinOptimizedManager.js - æŠ–éŸ³ä¸“ç”¨ç®¡ç†å™¨ï¼ˆæ–°å¢ï¼‰
- **ç§»åŠ¨ç«¯æ¨¡æ‹Ÿ**ï¼šiPhone 375x812 åˆ†è¾¨ç‡ï¼Œå®Œæ•´è§¦æ‘¸æ”¯æŒ
- **ç™»å½•çŠ¶æ€ä¿æŒ**ï¼šCookieæŒä¹…åŒ– + å®šæœŸå¿ƒè·³ä¿æ´»
- **è§†é¢‘èµ„æºå±è”½**ï¼šé˜»æ–­ .mp4/.webm å’ŒæŠ–éŸ³è§†é¢‘API
- **ç½‘ç»œä¼˜åŒ–**ï¼šä¿æŒå¿…è¦è¿æ¥ï¼Œå±è”½å¹¿å‘Šå’Œè¿½è¸ª
- **è‡ªåŠ¨ç»´æŠ¤**ï¼šå®šæœŸæ£€æŸ¥ç™»å½•çŠ¶æ€å’Œå†…å­˜æ¸…ç†

### ultraLowMemoryManager.js - è¶…ä½å†…å­˜ç®¡ç†å™¨ï¼ˆæ–°å¢ï¼‰
- **å†…å­˜å‹åŠ›åˆ†çº§**ï¼š0-æ­£å¸¸ï¼Œ1-è½»åº¦ï¼Œ2-ä¸­åº¦ï¼Œ3-é‡åº¦
- **æ™ºèƒ½ä¼‘çœ ç­–ç•¥**ï¼šæ ¹æ®å†…å­˜å‹åŠ›è‡ªåŠ¨è°ƒæ•´ä¼‘çœ é˜ˆå€¼
- **å®ä¾‹ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šåˆ›å»ºâ†’æ´»è·ƒâ†’ä¼‘çœ â†’å”¤é†’â†’é”€æ¯
- **ç´§æ€¥å†…å­˜é‡Šæ”¾**ï¼šå†…å­˜ä½¿ç”¨è¶…è¿‡90%æ—¶å¼ºåˆ¶æ¸…ç†
- é”™è¯¯ç‡ç›‘æ§
- è‡ªåŠ¨ä¼˜åŒ–å»ºè®®ç”Ÿæˆ
- é…ç½®å‚æ•°åŠ¨æ€è°ƒæ•´

### æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§è¯¦è§£

#### 1. æ™ºèƒ½æˆªå›¾ç³»ç»Ÿ
- **å¢é‡æˆªå›¾**ï¼šåªåœ¨å†…å®¹å˜åŒ–æ—¶å‘é€æˆªå›¾ï¼Œå‡å°‘90%å¸¦å®½æ¶ˆè€—
- **è‡ªé€‚åº”é¢‘ç‡**ï¼šæ ¹æ®ç”¨æˆ·æ´»åŠ¨è‡ªåŠ¨è°ƒæ•´æˆªå›¾é—´éš”ï¼ˆ200ms-2000msï¼‰
- **è´¨é‡ä¼˜åŒ–**ï¼šé™ä½JPEGè´¨é‡åˆ°30ï¼Œæå‡ä¼ è¾“é€Ÿåº¦
- **å“ˆå¸Œå¯¹æ¯”**ï¼šMD5å“ˆå¸Œå¿«é€Ÿæ£€æµ‹æˆªå›¾å˜åŒ–

#### 2. æ“ä½œæ‰¹å¤„ç†ç³»ç»Ÿ
- **æ‰¹é‡æ‰§è¡Œ**ï¼š50mså†…çš„æ“ä½œåˆå¹¶æ‰§è¡Œï¼Œå‡å°‘æµè§ˆå™¨äº¤äº’æ¬¡æ•°
- **ä¼˜å…ˆçº§è°ƒåº¦**ï¼šé‡è¦æ“ä½œä¼˜å…ˆå¤„ç†
- **é”™è¯¯æ¢å¤**ï¼šæ“ä½œå¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æœºåˆ¶

#### 3. æ€§èƒ½ç›‘æ§ç³»ç»Ÿ
- **å®æ—¶ç»Ÿè®¡**ï¼šæˆªå›¾æ•°é‡ã€æ“ä½œæ¬¡æ•°ã€å“åº”æ—¶é—´
- **å¸¦å®½ç›‘æ§**ï¼šæ•°æ®ä¼ è¾“é‡ç»Ÿè®¡å’Œåˆ†æ
- **é”™è¯¯è¿½è¸ª**ï¼šé”™è¯¯ç‡åˆ†æå’Œæ•…éšœè¯Šæ–­
- **æ€§èƒ½æŠ¥å‘Š**ï¼šè¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
npm install
```

### 2. å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼
npm start

# ç”Ÿäº§æ¨¡å¼ï¼ˆä½¿ç”¨ PM2ï¼‰
npm run start:prod
```

### 3. è®¿é—®ç•Œé¢
- **ä¸»æ§åˆ¶é¢æ¿**: http://localhost:3000
- **é«˜çº§ä»ªè¡¨æ¿**: http://localhost:3000/dashboard
- **æ€§èƒ½ç›‘æ§**: http://localhost:3000/performance

## API æ¥å£æ–‡æ¡£

### åŸºç¡€å®ä¾‹ç®¡ç†
- `POST /api/browsers/create` - åˆ›å»ºæµè§ˆå™¨å®ä¾‹
- `GET /api/browsers` - è·å–å®ä¾‹åˆ—è¡¨
- `GET /api/browsers/:id/pages` - è·å–å®ä¾‹æ ‡ç­¾é¡µ
- `DELETE /api/browsers/:id` - åˆ é™¤å®ä¾‹
- `POST /api/browsers/:id/restore` - æ¢å¤å®ä¾‹

### é«˜æ€§èƒ½æ“ä½œ
- `POST /api/browsers/:id/batch-operations` - æ‰¹é‡æ“ä½œ
- `GET /api/browsers/:id/screenshot` - å¿«é€Ÿæˆªå›¾
- `GET /api/browsers/:id/stats` - å®ä¾‹ç»Ÿè®¡
- `POST /api/browsers/:id/optimize` - å†…å­˜ä¼˜åŒ–
- `POST /api/browsers/:id/preload` - èµ„æºé¢„åŠ è½½

### æŠ–éŸ³ä¸“ç”¨ API
- `POST /api/browsers/douyin/create` - åˆ›å»ºæŠ–éŸ³ä¸“ç”¨å®ä¾‹
- `GET /api/browsers/douyin/stats` - æŠ–éŸ³å®ä¾‹ç»Ÿè®¡
- `POST /api/browsers/douyin/maintenance` - æŠ–éŸ³å®ä¾‹ç»´æŠ¤
- `GET /api/browsers/:id/douyin/login-status` - æ£€æŸ¥æŠ–éŸ³ç™»å½•çŠ¶æ€

### è¶…ä½å†…å­˜ä¼˜åŒ– API
- `GET /api/browsers/memory/stats` - æ ‡å‡†å†…å­˜ä½¿ç”¨ç»Ÿè®¡
- `GET /api/browsers/memory/ultra-stats` - è¶…ä½å†…å­˜æ¨¡å¼è¯¦ç»†ç»Ÿè®¡
- `POST /api/browsers/memory/optimize` - å…¨å±€å†…å­˜ä¼˜åŒ–
- `POST /api/browsers/memory/emergency-release` - ç´§æ€¥å†…å­˜é‡Šæ”¾
- `GET /api/browsers/memory/can-create` - æ£€æŸ¥æ˜¯å¦å¯åˆ›å»ºå®ä¾‹
- `POST /api/browsers/batch-create` - æ‰¹é‡åˆ›å»ºå®ä¾‹

### å®ä¾‹ä¼‘çœ ç®¡ç† API
- `POST /api/browsers/:id/hibernate` - ä¼‘çœ æŒ‡å®šå®ä¾‹
- `POST /api/browsers/:id/wakeup` - å”¤é†’ä¼‘çœ å®ä¾‹
- `GET /api/browsers/system/resources` - ç³»ç»Ÿèµ„æºç»Ÿè®¡
- `GET /api/browsers/system/recommendations` - ä¼˜åŒ–å»ºè®®
- `GET /api/browsers/system/operations` - æ“ä½œç»Ÿè®¡
- `GET /api/browsers/:id/resources` - å®ä¾‹èµ„æºè¯¦æƒ…
- `GET /api/browsers/performance/global` - å…¨å±€æ€§èƒ½ç»Ÿè®¡

### WebSocket è¿æ¥
- `ws://localhost:3000/browsers/ws/operate/:id` - å®æ—¶æ“ä½œè¿æ¥

## æ€§èƒ½ä¼˜åŒ–ç‰¹æ€§

### 1. æ™ºèƒ½æˆªå›¾ç³»ç»Ÿ
```javascript
{
  "deltaScreenshot": true,      // å¢é‡æˆªå›¾
  "adaptiveInterval": true,     // è‡ªé€‚åº”é¢‘ç‡
  "screenshotInterval": 500,    // åŸºç¡€é—´éš”(ms)
  "minInterval": 200,           // æœ€å°é—´éš”
  "maxInterval": 2000          // æœ€å¤§é—´éš”
}
```

### 2. æ“ä½œæ‰¹å¤„ç†
```javascript
{
  "batchOperations": true,      // å¯ç”¨æ‰¹å¤„ç†
  "batchTimeout": 50,          // æ‰¹å¤„ç†è¶…æ—¶(ms)
  "enableCompression": true     // å¯ç”¨å‹ç¼©
}
```

### 3. èµ„æºç®¡ç†
- è‡ªåŠ¨å†…å­˜ä¼˜åŒ–
- CPU ä½¿ç”¨ç‡ç›‘æ§
- å®ä¾‹è¶…æ—¶æ¸…ç†
- åŠ¨æ€é…ç½®è°ƒæ•´

### 4. æ€§èƒ½ç›‘æ§
- å®æ—¶æ€§èƒ½æŒ‡æ ‡
- å“åº”æ—¶é—´åˆ†æ
- å¸¦å®½ä½¿ç”¨ç»Ÿè®¡
- é”™è¯¯ç‡ç›‘æ§

## é…ç½®è¯´æ˜

### config.js ä¸»è¦é…ç½®é¡¹

```javascript
module.exports = {
  server: {
    port: 3000,
    host: 'localhost'
  },
  websocket: {
    screenshotInterval: 500,
    adaptiveInterval: true,
    minInterval: 200,
    maxInterval: 2000,
    batchOperations: true,
    batchTimeout: 50,
    enableCompression: true,
    deltaScreenshot: true
  },
  browser: {
    screenshotOptions: {
      type: 'jpeg',
      quality: 30,
      optimizeForSpeed: true
    }
  }
};
```

## ä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºæŠ–éŸ³ä¸“ç”¨å®ä¾‹
```bash
# åˆ›å»ºæŠ–éŸ³ä¸“ç”¨ä¼˜åŒ–å®ä¾‹
curl -X POST http://localhost:3000/api/browsers/douyin/create

# æˆ–è€…é€šè¿‡é€šç”¨æ¥å£åˆ›å»ºï¼ˆä¼šè‡ªåŠ¨æ£€æµ‹æŠ–éŸ³åŸŸåï¼‰
curl -X POST http://localhost:3000/api/browsers/create \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.douyin.com"}'
```

### 2. æŠ–éŸ³ä¸“ç”¨æ“ä½œ
```bash
# æŸ¥çœ‹æŠ–éŸ³å®ä¾‹ç»Ÿè®¡
curl http://localhost:3000/api/browsers/douyin/stats

# æ£€æŸ¥ç™»å½•çŠ¶æ€
curl http://localhost:3000/api/browsers/{id}/douyin/login-status

# æ‰§è¡ŒæŠ–éŸ³ç»´æŠ¤
curl -X POST http://localhost:3000/api/browsers/douyin/maintenance
```

### 3. åˆ›å»ºæ™®é€šå®ä¾‹
```bash
curl -X POST http://localhost:3000/api/browsers/create \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com"}'
```

### 2. è¶…ä½å†…å­˜æ¨¡å¼æ“ä½œ
```bash
# æŸ¥çœ‹è¶…ä½å†…å­˜æ¨¡å¼ç»Ÿè®¡
curl http://localhost:3000/api/browsers/memory/ultra-stats

# ç´§æ€¥å†…å­˜é‡Šæ”¾
curl -X POST http://localhost:3000/api/browsers/memory/emergency-release

# ä¼‘çœ æŒ‡å®šå®ä¾‹
curl -X POST http://localhost:3000/api/browsers/{id}/hibernate

# å”¤é†’ä¼‘çœ å®ä¾‹
curl -X POST http://localhost:3000/api/browsers/{id}/wakeup
```

### 3. æ‰¹é‡æ“ä½œ
```bash
curl -X POST http://localhost:3000/api/browsers/{id}/batch-operations \
  -H "Content-Type: application/json" \
  -d '{
    "operations": [
      {"type": "click", "x": 100, "y": 200},
      {"type": "type", "text": "Hello World"},
      {"type": "goto", "url": "https://google.com"}
    ]
  }'
```

### 4. è·å–æ€§èƒ½ç»Ÿè®¡
```bash
curl http://localhost:3000/api/browsers/performance/global
```

### 5. æ£€æŸ¥å†…å­˜çŠ¶æ€
```bash
# æ£€æŸ¥æ˜¯å¦å¯ä»¥åˆ›å»ºæ–°å®ä¾‹
curl http://localhost:3000/api/browsers/memory/can-create

# æŸ¥çœ‹å†…å­˜å‹åŠ›ç­‰çº§
curl http://localhost:3000/api/browsers/memory/ultra-stats | jq '.memoryPressureLevel'
```

### 4. WebSocket è¿æ¥ç¤ºä¾‹
```javascript
const ws = new WebSocket('ws://localhost:3000/browsers/ws/operate/{instanceId}');

ws.onmessage = function(event) {
  if (event.data instanceof Blob) {
    // å¤„ç†æˆªå›¾
    const img = document.createElement('img');
    img.src = URL.createObjectURL(event.data);
    document.body.appendChild(img);
  } else {
    // å¤„ç†JSONæ¶ˆæ¯
    const data = JSON.parse(event.data);
    console.log('æ”¶åˆ°æ¶ˆæ¯:', data);
  }
};

// å‘é€æ“ä½œ
ws.send(JSON.stringify({
  type: 'click',
  payload: { x: 100, y: 200 }
}));
```

## æ€§èƒ½æµ‹è¯•ç»“æœ

### ä¼˜åŒ–å‰ vs ä¼˜åŒ–å

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| æˆªå›¾ä¼ è¾“é‡ | 100% | 15% | 85%â†“ |
| å¹³å‡å“åº”æ—¶é—´ | 200ms | 50ms | 75%â†“ |
| å†…å­˜ä½¿ç”¨ | 100% | 70% | 30%â†“ |
| CPU ä½¿ç”¨ç‡ | 100% | 60% | 40%â†“ |
| å¹¶å‘å®ä¾‹æ•° | 5ä¸ª | 15ä¸ª | 200%â†‘ |

### å†…å­˜ä¼˜åŒ–æµ‹è¯•ç»“æœ

**å†…å­˜ä½¿ç”¨å¯¹æ¯” (å•å®ä¾‹)**:
| ä¼˜åŒ–é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | èŠ‚çœ |
|----------|--------|--------|------|
| åŸºç¡€å†…å­˜ | 150MB | 45MB | 70%â†“ |
| å¸¦å›¾ç‰‡é¡µé¢ | 300MB | 80MB | 73%â†“ |
| å¤æ‚é¡µé¢ | 500MB | 120MB | 76%â†“ |

**å¹¶å‘èƒ½åŠ›å¯¹æ¯”**:
| è®¾å¤‡é…ç½® | ä¼˜åŒ–å‰æœ€å¤§å®ä¾‹ | ä¼˜åŒ–åæœ€å¤§å®ä¾‹ | æå‡ |
|----------|----------------|----------------|------|
| 4GBå†…å­˜ | 3ä¸ª | 12ä¸ª | 300%â†‘ |
| 8GBå†…å­˜ | 8ä¸ª | 35ä¸ª | 337%â†‘ |
| 16GBå†…å­˜ | 15ä¸ª | 80ä¸ª | 433%â†‘ |

### å†…å­˜ä¼˜åŒ–ç‰¹æ€§è¯¦è§£

#### 1. å¯åŠ¨å‚æ•°ä¼˜åŒ–
- `--single-process`: å•è¿›ç¨‹æ¨¡å¼ï¼Œå¤§å¹…å‡å°‘å†…å­˜
- `--disable-images`: é»˜è®¤ç¦ç”¨å›¾ç‰‡åŠ è½½
- `--max-old-space-size=64`: é™åˆ¶V8å†…å­˜ä½¿ç”¨
- `--memory-pressure-off`: å…³é—­å†…å­˜å‹åŠ›æ£€æµ‹

#### 2. é¡µé¢çº§ä¼˜åŒ–
- è‡ªåŠ¨æ‹¦æˆªå›¾ç‰‡ã€å­—ä½“ã€åª’ä½“èµ„æº
- ç¦ç”¨ä¸å¿…è¦çš„æµè§ˆå™¨åŠŸèƒ½
- æ¸…ç†å®šæ—¶å™¨å’Œäº‹ä»¶ç›‘å¬å™¨
- å¼ºåˆ¶åƒåœ¾å›æ”¶

#### 3. æ™ºèƒ½å®ä¾‹ç®¡ç†
- è‡ªåŠ¨è®¡ç®—æœ€å¤§å®ä¾‹æ•°
- å®šæœŸæ¸…ç†æ— ç”¨å®ä¾‹
- åŸºäºå†…å­˜ä½¿ç”¨ç‡åŠ¨æ€è°ƒæ•´
- å®ä¾‹è¶…æ—¶è‡ªåŠ¨å›æ”¶

#### 4. æ‰¹é‡æ“ä½œä¼˜åŒ–
```bash
# æ‰¹é‡åˆ›å»º5ä¸ªå®ä¾‹
curl -X POST http://localhost:3000/api/browsers/batch-create \
  -H "Content-Type: application/json" \
  -d '{"count": 5, "url": "https://example.com"}'
```

**ä½ç«¯è®¾å¤‡ (4GBå†…å­˜)**:
```javascript
{
  screenshotInterval: 1000,
  maxInstances: 3,
  screenshotQuality: 20
}
```

**ä¸­ç«¯è®¾å¤‡ (8GBå†…å­˜)**:
```javascript
{
  screenshotInterval: 500,
  maxInstances: 8,
  screenshotQuality: 30
}
```

**é«˜ç«¯è®¾å¤‡ (16GB+å†…å­˜)**:
```javascript
{
  screenshotInterval: 200,
  maxInstances: 20,
  screenshotQuality: 50
}
```

## æ•…éšœæ’é™¤

### 1. å†…å­˜ä½¿ç”¨è¿‡é«˜
- æ£€æŸ¥å®ä¾‹æ•°é‡æ˜¯å¦è¿‡å¤š
- å¯ç”¨è‡ªåŠ¨ä¼˜åŒ–: `POST /api/browsers/:id/optimize`
- é™ä½æˆªå›¾è´¨é‡å’Œé¢‘ç‡

### 2. å“åº”é€Ÿåº¦æ…¢
- å¯ç”¨æ“ä½œæ‰¹å¤„ç†
- æ£€æŸ¥ç³»ç»Ÿ CPU ä½¿ç”¨ç‡
- ä½¿ç”¨èµ„æºç›‘æ§é¢æ¿åˆ†ææ€§èƒ½

### 3. å®ä¾‹åˆ›å»ºå¤±è´¥
- æ£€æŸ¥ç³»ç»Ÿèµ„æºé™åˆ¶
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—
- ç¡®è®¤ Chromium è·¯å¾„æ­£ç¡®

## æ‰©å±•å¼€å‘

### 1. è‡ªå®šä¹‰æ“ä½œç±»å‹
```javascript
// åœ¨ advancedOperationManager.js ä¸­æ·»åŠ æ–°æ“ä½œ
case 'customAction':
  await page.evaluate(() => {
    // è‡ªå®šä¹‰æµè§ˆå™¨æ“ä½œ
  });
  break;
```

### 2. è‡ªå®šä¹‰æ€§èƒ½æŒ‡æ ‡
```javascript
// åœ¨ performanceManager.js ä¸­æ·»åŠ æ–°æŒ‡æ ‡
recordCustomMetric(instanceId, metricName, value) {
  // è®°å½•è‡ªå®šä¹‰æŒ‡æ ‡
}
```

### 3. è‡ªå®šä¹‰ä¼˜åŒ–ç­–ç•¥
```javascript
// åœ¨ resourceManager.js ä¸­æ·»åŠ ä¼˜åŒ–ç­–ç•¥
addOptimizationStrategy(name, strategy) {
  // æ·»åŠ æ–°çš„ä¼˜åŒ–ç­–ç•¥
}
```

## éƒ¨ç½²å»ºè®®

### 1. ç”Ÿäº§ç¯å¢ƒ
- ä½¿ç”¨ PM2 è¿›è¡Œè¿›ç¨‹ç®¡ç†
- å¯ç”¨æ—¥å¿—è½®è½¬
- é…ç½®åå‘ä»£ç† (Nginx)
- å¯ç”¨ HTTPS

### 2. Docker éƒ¨ç½²
```dockerfile
FROM node:16-alpine
RUN apk add --no-cache chromium
ENV PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=true
ENV PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium-browser
COPY . /app
WORKDIR /app
RUN npm install --production
EXPOSE 3000
CMD ["npm", "start"]
```

### 3. ç›‘æ§å’ŒæŠ¥è­¦
- é›†æˆ Prometheus/Grafana
- è®¾ç½®èµ„æºä½¿ç”¨æŠ¥è­¦
- é…ç½®æ—¥å¿—æ”¶é›†
- æœåŠ¡å™¨å¯åŠ¨å’ŒåŸºç¡€é…ç½®
- æ•°æ®åº“åˆå§‹åŒ–
- è·¯ç”±æŒ‚è½½
- WebSocket æœåŠ¡å¯åŠ¨
- ä¼˜é›…å…³é—­å¤„ç†

### config.js - é…ç½®ç®¡ç†
- æœåŠ¡å™¨é…ç½®ï¼ˆç«¯å£ã€ä¸»æœºï¼‰
- æ•°æ®åº“è·¯å¾„é…ç½®
- æµè§ˆå™¨å¯åŠ¨å‚æ•°
- WebSocket é…ç½®
- æŒ‡çº¹ç”Ÿæˆè§„åˆ™

### browserManager.js - æµè§ˆå™¨ç®¡ç†
- Chromium è·¯å¾„è‡ªåŠ¨æ£€æµ‹
- éšæœºæŒ‡çº¹ç”Ÿæˆ
- æµè§ˆå™¨å®ä¾‹å¯åŠ¨
- å†å²å®ä¾‹æ¢å¤
- æ‰¹é‡å®ä¾‹ç®¡ç†

### wsManager.js - WebSocket å¤„ç†
- WebSocket è¿æ¥ç®¡ç†
- å®æ—¶æˆªå›¾æ¨é€
- é¼ æ ‡é”®ç›˜äº‹ä»¶å¤„ç†
- æ ‡ç­¾é¡µæ“ä½œå¤„ç†
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### routes/browsers.js - API è·¯ç”±
- POST /browsers/create - åˆ›å»ºæ–°å®ä¾‹
- GET /browsers - è·å–å®ä¾‹åˆ—è¡¨
- GET /browsers/:id/pages - è·å–æ ‡ç­¾é¡µä¿¡æ¯
- POST /browsers/:id/restore - æ¢å¤å†å²å®ä¾‹
- DELETE /browsers/:id - åˆ é™¤å®ä¾‹

## å®‰è£…å’Œè¿è¡Œ

### ç¯å¢ƒè¦æ±‚
- Node.js 16+
- ç³»ç»Ÿå®‰è£… Chromium/Chrome æµè§ˆå™¨

### å®‰è£…ä¾èµ–
```bash
npm install
```

### å¼€å‘æ¨¡å¼è¿è¡Œ
```bash
npm run dev
```

### ç”Ÿäº§æ¨¡å¼è¿è¡Œ
```bash
node index.js
```

### PM2 éƒ¨ç½²
```bash
npm install -g pm2
pm2 start ecosystem.config.js
```

## PM2 é…ç½®æ³¨æ„äº‹é¡¹
åœ¨ `ecosystem.config.js` ä¸­æ·»åŠ ä»¥ä¸‹é…ç½®é˜²æ­¢é¢‘ç¹é‡å¯ï¼š
```javascript
module.exports = {
  apps: [{
    name: 'puppeteer-manager',
    script: 'index.js',
    ignore_watch: ['user_data', 'browsers.db', 'node_modules']
  }]
}
```

## API æ–‡æ¡£

### åˆ›å»ºå®ä¾‹
```bash
curl -X POST http://localhost:3000/browsers/create \
  -H "Content-Type: application/json" \
  -d '{"url": "https://example.com"}'
```

### è·å–å®ä¾‹åˆ—è¡¨
```bash
curl http://localhost:3000/browsers
```

### åˆ é™¤å®ä¾‹
```bash
curl -X DELETE http://localhost:3000/browsers/{instance_id}
```

## WebSocket æ“ä½œ
è¿æ¥åœ°å€ï¼š`ws://localhost:3000/browsers/ws/operate/{instance_id}`

æ”¯æŒçš„æ“ä½œç±»å‹ï¼š
- `click` - é¼ æ ‡ç‚¹å‡»
- `mousemove` - é¼ æ ‡ç§»åŠ¨
- `keydown/keyup` - é”®ç›˜æŒ‰é”®
- `wheel` - é¼ æ ‡æ»šè½®
- `switchTab` - åˆ‡æ¢æ ‡ç­¾é¡µ
- `refreshTab` - åˆ·æ–°æ ‡ç­¾é¡µ
- `closeTab` - å…³é—­æ ‡ç­¾é¡µ
- `getTabs` - è·å–æ ‡ç­¾é¡µåˆ—è¡¨

## è¶…ä½å†…å­˜æ¨¡å¼é…ç½®

### å†…å­˜å‹åŠ›ç­‰çº§
- **Level 0 (æ­£å¸¸)**: å†…å­˜ä½¿ç”¨ < 70%ï¼Œä¼‘çœ é˜ˆå€¼ 30åˆ†é’Ÿ
- **Level 1 (è½»åº¦)**: å†…å­˜ä½¿ç”¨ 70-80%ï¼Œä¼‘çœ é˜ˆå€¼ 15åˆ†é’Ÿ
- **Level 2 (ä¸­åº¦)**: å†…å­˜ä½¿ç”¨ 80-90%ï¼Œä¼‘çœ é˜ˆå€¼ 5åˆ†é’Ÿ
- **Level 3 (é‡åº¦)**: å†…å­˜ä½¿ç”¨ > 90%ï¼Œä¼‘çœ é˜ˆå€¼ 2åˆ†é’Ÿï¼Œå¯åŠ¨ç´§æ€¥æ¸…ç†

### å®ä¾‹ç”Ÿå‘½å‘¨æœŸ
```
åˆ›å»º â†’ æ´»è·ƒä½¿ç”¨ â†’ ç©ºé—²æ£€æµ‹ â†’ è‡ªåŠ¨ä¼‘çœ  â†’ çŠ¶æ€ä¿å­˜ â†’ æŒ‰éœ€å”¤é†’
```

### å†…å­˜ä¼˜åŒ–å‚æ•°
```javascript
// config.js ä¸­çš„è¶…ä½å†…å­˜é…ç½®
browser: {
  launchOptions: {
    args: [
      '--max-old-space-size=128',    // é™åˆ¶V8å†…å­˜åˆ°128MB
      '--single-process',            // å•è¿›ç¨‹æ¨¡å¼
      '--disable-images',            // ç¦ç”¨å›¾ç‰‡
      '--disable-javascript',        // å¯é€‰ï¼šç¦ç”¨JS
      '--memory-pressure-off',       // å…³é—­å†…å­˜å‹åŠ›æ£€æµ‹
      '--aggressive-cache-discard'   // æ¿€è¿›ç¼“å­˜æ¸…ç†
    ]
  }
},
websocket: {
  screenshotInterval: 2000,          // å¢åŠ æˆªå›¾é—´éš”
  screenshotOnDemand: true,          // æŒ‰éœ€æˆªå›¾
  lowMemoryMode: true,               // ä½å†…å­˜æ¨¡å¼
  maxScreenshotCache: 2              // é™åˆ¶æˆªå›¾ç¼“å­˜
}
```

### æé™å¹¶å‘æµ‹è¯•ç»“æœ
| ç³»ç»Ÿé…ç½® | æ ‡å‡†æ¨¡å¼ | å†…å­˜ä¼˜åŒ– | è¶…ä½å†…å­˜ | æå‡å€æ•° |
|----------|----------|----------|----------|----------|
| 4GB RAM | 5ä¸ªå®ä¾‹ | 12ä¸ªå®ä¾‹ | 25ä¸ªå®ä¾‹ | **5x** |
| 8GB RAM | 10ä¸ªå®ä¾‹ | 25ä¸ªå®ä¾‹ | 50ä¸ªå®ä¾‹ | **5x** |
| 16GB RAM | 20ä¸ªå®ä¾‹ | 50ä¸ªå®ä¾‹ | 100ä¸ªå®ä¾‹ | **5x** |

## æŠ€æœ¯æ ˆ
- **åç«¯**: Node.js + Express
- **æ•°æ®åº“**: SQLite3
- **æµè§ˆå™¨æ§åˆ¶**: Puppeteer
- **å®æ—¶é€šä¿¡**: WebSocket (ws)
- **å‰ç«¯**: åŸç”Ÿ HTML/CSS/JavaScript
- **å†…å­˜ç®¡ç†**: è‡ªç ”è¶…ä½å†…å­˜ç®¡ç†å™¨

## å¼€å‘å’Œç»´æŠ¤
- ä»£ç é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼ŒèŒè´£åˆ†ç¦»
- å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- æ”¯æŒé…ç½®åŒ–ç®¡ç†
- ä¼˜é›…çš„è¿›ç¨‹å…³é—­å¤„ç†
- å®æ—¶å†…å­˜ç›‘æ§å’Œè‡ªåŠ¨ä¼˜åŒ–

## æ³¨æ„äº‹é¡¹
1. **å†…å­˜ç®¡ç†**: è¶…ä½å†…å­˜æ¨¡å¼ä¼šè‡ªåŠ¨ç®¡ç†å†…å­˜ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
2. **å®ä¾‹ä¼‘çœ **: ä¼‘çœ å®ä¾‹ä¼šä¿å­˜çŠ¶æ€ï¼Œå”¤é†’æ—¶è‡ªåŠ¨æ¢å¤é¡µé¢
3. **ç´§æ€¥é‡Šæ”¾**: å†…å­˜ä¸è¶³æ—¶ç³»ç»Ÿä¼šè‡ªåŠ¨é‡Šæ”¾éå…³é”®å®ä¾‹
4. **ç£ç›˜ç©ºé—´**: å®šæœŸæ¸…ç† `user_data` ç›®å½•ï¼Œç‰¹åˆ«æ˜¯ä¼‘çœ å®ä¾‹çš„æ•°æ®
5. **ç”Ÿäº§éƒ¨ç½²**: å»ºè®®ä½¿ç”¨ PM2 å¹¶å¯ç”¨ `--expose-gc` å‚æ•°
6. **é˜²ç«å¢™**: éœ€è¦å¼€æ”¾å¯¹åº”ç«¯å£ï¼ˆé»˜è®¤ 3000ï¼‰

### å¯åŠ¨æ—¶å¯ç”¨åƒåœ¾å›æ”¶
```bash
# å¯ç”¨åƒåœ¾å›æ”¶ä»¥è·å¾—æœ€ä½³å†…å­˜æ•ˆæœ
node --expose-gc index.js

# æˆ–ä½¿ç”¨ PM2
pm2 start ecosystem.config.js --node-args="--expose-gc"

## debian å®‰è£…chromium
apt-get install chromium chromium-l10n
```
